<!DOCTYPE html>
<html>
<head>
  <title>TA/DA Bill Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script>
    let finalAmount=0.00, da=200.00,honorarium=500.00;
    let parts;
    
    function dateFormat(){
      let dateValue = document.getElementById('date').value;
      parts = dateValue.split("-"); 
    }
    function travelRate(){
      let mode = document.getElementById("travelMode").value;
      let rate = document.getElementById("rate1");
      console.log(mode);
      let price = {petrol_car:10, CNG_car:5,diesel_car:8,scooter:3,taxi:8,other:0};
      rate.value = price[mode];
    }
    function calculateAmount() {
      let km = document.getElementById("km1").value;
      let rate = document.getElementById("rate1").value;
      km = parseFloat(km) || 0;
      rate = parseFloat(rate) || 0;
      let total = km * rate;
      
      document.getElementById("amount1").value = total.toFixed(2);

      // let km2 = document.getElementById("km2").value;
      // let rate2 = document.getElementById("rate2").value;
      // km2 = parseFloat(km2) || 0;
      // rate2 = parseFloat(rate2) || 0;
      // let total2 = km2 * rate2;
      // // console.log(km+" "+rate+" "+total);
      // document.getElementById("amount2").value = total2.toFixed(2);
      document.getElementById("totalAmount").value = (2*total).toFixed(2);
      finalAmount = (total*2)+da+honorarium;
    }

    // function updateGrandTotal() {
    //   let sum = 0;
    //   for (let i = 1; i <= 2; i++) {
    //     sum += parseFloat(document.getElementById("amount" + i).value) || 0;
    //   }
      
    // }
  </script>
</head>
<body>
  <h2>Fill TA/DA Bill</h2>
  <form id="tadaForm">
    <label>Date: <input type="date" id="date" onchange="dateFormat()"></label><br><br>
    <table>
      <tr>
        <td><label>Name: </td><td><input type="text" id="name" style="width:230px"></label></td>
        <td><label>Designation: </td><td><input type="text" id="designation" style="width:230px"></label></td>
      </tr>
      <tr>
        <td><label>Mobile No: </td><td><input type="text" id="mobile" style="width:230px"></label></td>
        <td><label>Department: </td><td><input type="text" id="department" style="width:230px"></label></td>
      </tr>
      <tr>
        <td><label>Institute: </td><td><input type="text" id="institute" style="width:230px"></label></td>
        <td><label>Purpose: </td><td><input type="text" id="purpose" style="width:230px"></label></td>
      </tr>
      <tr>
        <td><label>Subject Code: </td><td><input type="text" id="subCode" style="width:230px"></label></td>
        <td><label>Subject Name: </td><td><input type="text" id="subName" style="width:230px"></label></td>
      </tr>
    </table>
    <h3>A. Travel Allowance</h3>
        <!-- <label>From: <input type="text" id="parentInst"></label> 
        <label>To: <input type="text" id="ourInst"></label> -->

        <label>Travel Mode (car/bus/taxi): 
          <select id="travelMode" name="travelMode" onchange="travelRate()">
             <option value="">--Select--</option>
            <option value="petrol_car">car (petrol)</option>
            <option value="CNG_car">car (CNG)</option>
            <option value="diesel_car">car (Diesel)</option>
            <option value="bus">bus</option>
            <option value="scooter">scooter</option>
            <option value="taxi">taxi</option>
            <option value="other">other</option>
          </select>
          </label>
        <label>KM: <input type="number" id="km1" style="width:50px" oninput="calculateAmount()"></label>
        <label>Rate: <input type="number" id="rate1" style="width:50px" oninput="calculateAmount()"> </label>
        <label>Amount: <input type="number" id="amount1" readonly> </label>
        <br>
        <!-- <label>From: <input type="text" id="parentInst"></label> 
        <label>To: <input type="text" id="ourInst"></label> -->
        <!-- <label>Travel Mode (car/bus/taxi): <input type="text" id="travelMode2" size="8"></label>
        <label>KM: <input type="number" id="km2" style="width:50px" oninput="calculateAmount()"></label>
        <label>Rate: <input type="number" id="rate2" style="width:50px" oninput="calculateAmount()"> </label>
        <label>Amount: <input type="number" id="amount2" readonly> </label> -->
        <br>
        <b><label>Total Amount: <input type="number" id="totalAmount" readonly> </label></b> (Calculated 2-way)
        <br>
        <b>D.A.: </b> <input type="number" id="da"> <br>
        <b>Honorarium: </b> <input type="number" id="hono">
        <script>
          document.getElementById("da").value = da.toFixed(2);
    document.getElementById("hono").value = honorarium.toFixed(2);
        </script>
      <h3>Bank Details</h3>
      <table>
        <tr><td><label>Account Name: </label></td><td><input type="text" id="accName"></td></tr>
        <tr><td><label>Bank Name: </label></td><td><input type="text" id="bankName"></td></tr>
        <tr><td><label>Branch: </label></td><td><input type="text" id="branch"></td></tr>
        <tr><td><label>Account No.: </label></td><td><input type="text" id="accNo"></td></tr>
        <tr><td><label>ISFC Code: </label></td><td><input type="text" id="isfc"></td></tr>
      </table>

    <br>
    <button type="button" onclick="generatePDF()">Generate PDF</button>
  </form>

  <script>
    async function generatePDF() {
      const url = "TA_DA bill.pdf"; // Template (place it in same folder)
      const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer());

      const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
      const pages = pdfDoc.getPages();
      const firstPage = pages[0];
      const secondPage = pages[1];

      //firstPage.drawText(document.getElementById("date").value, { x: 460, y: 770, size: 11 });
      firstPage.drawText(parts[2].toString(), { x: 462, y: 763, size: 11 });
      firstPage.drawText(parts[1].toString(), { x: 480, y: 763, size: 11 });
      firstPage.drawText(parts[0].toString(), { x: 500, y: 763, size: 11 });
      firstPage.drawText(document.getElementById("name").value, { x: 165, y: 715, size: 11 });
      firstPage.drawText(document.getElementById("designation").value, { x: 165, y: 695, size: 11 });
      firstPage.drawText(document.getElementById("mobile").value, { x: 450, y: 695, size: 11 });
      firstPage.drawText(document.getElementById("department").value, { x: 165, y: 675, size: 11 });
      firstPage.drawText(document.getElementById("institute").value, { x: 165, y: 655, size: 11 });
      firstPage.drawText(document.getElementById("purpose").value, { x: 165, y: 635, size: 11 });
      // A. Travel Allowance
        //First row
      firstPage.drawText(document.getElementById("date").value, { x: 80, y: 545, size: 10 });
      firstPage.drawText(document.getElementById("institute").value, { x: 135, y: 545, size: 9 });
      firstPage.drawText("DIET", { x: 225, y: 545, size: 10 });
      firstPage.drawText(document.getElementById("travelMode").value, { x: 285, y: 545, size: 11 });
      firstPage.drawText(document.getElementById("km1").value, { x: 370, y: 545, size: 11 });
      firstPage.drawText(document.getElementById("rate1").value+"/-Rs.", { x: 420, y: 545, size: 11 });
      firstPage.drawText(document.getElementById("amount1").value+"/-Rs.", { x: 475, y: 545, size: 11 });
          //second row
      firstPage.drawText(document.getElementById("date").value, { x: 80, y: 528, size: 10 });
      firstPage.drawText("DIET", { x: 155, y: 528, size: 10 });
      firstPage.drawText(document.getElementById("institute").value, { x: 205, y: 528, size: 9 });
      firstPage.drawText(document.getElementById("travelMode").value, { x: 285, y: 528, size: 11 });
      firstPage.drawText(document.getElementById("km1").value, { x: 370, y: 528, size: 11 });
      firstPage.drawText(document.getElementById("rate1").value+"/-Rs.", { x: 420, y: 528, size: 11 });
      firstPage.drawText(document.getElementById("amount1").value+"/-Rs.", { x: 475, y: 528, size: 11 });
      firstPage.drawText(document.getElementById("totalAmount").value+"/-Rs.", { x: 475, y: 488, size: 12 });
        
      //B. Dearness Allowance
      firstPage.drawText(document.getElementById("date").value, { x: 80, y: 415, size: 10 });
      firstPage.drawText(document.getElementById("institute").value, { x: 205, y: 415, size: 9 });
      firstPage.drawText("DIET", { x: 155, y: 415, size: 10 });
      firstPage.drawText("Nature of Expense", { x: 285, y: 415, size: 11 });
      firstPage.drawText(da.toString()+"/-Rs.", { x: 400, y: 415, size: 11 });
      firstPage.drawText(da.toString()+"/-Rs.", { x: 470, y: 415, size: 11 });
      firstPage.drawText(da.toString()+"/-Rs.", { x: 470, y: 375, size: 12 });
      
      //C. Examination honorarium
      firstPage.drawText(document.getElementById("date").value, { x: 80, y: 307, size: 10 });
      firstPage.drawText(document.getElementById("purpose").value, { x: 175, y: 307, size: 10 });
      firstPage.drawText(document.getElementById("subCode").value, { x: 255, y: 307, size: 10 });
      firstPage.drawText(document.getElementById("subName").value, { x: 335, y: 307, size: 10 });
      firstPage.drawText(honorarium.toString()+"/-Rs.", { x: 420, y: 307, size: 11 });
      firstPage.drawText(honorarium.toString()+"/-Rs.", { x: 475, y: 307, size: 11 });
      firstPage.drawText(honorarium.toString()+"/-Rs.", { x: 475, y: 265, size: 12 });

      //D. Miscellaneous
      firstPage.drawText("00.00", { x: 332, y: 181, size: 12 });

      //Summary
      firstPage.drawText(finalAmount.toString()+"/-Rs.", { x: 240, y: 120, size: 12 });
      firstPage.drawText("0.00/-Rs.", { x: 240, y: 105, size: 12 });
      firstPage.drawText(finalAmount.toString()+"/-Rs.", { x: 240, y: 88, size: 14 });
      //second page
      secondPage.drawText(document.getElementById("accName").value, { x: 235, y: 590, size: 11 });
      secondPage.drawText(document.getElementById("bankName").value, { x: 235, y: 570, size: 11 });
      secondPage.drawText(document.getElementById("branch").value, { x: 235, y: 550, size: 11 });
      secondPage.drawText(document.getElementById("accNo").value, { x: 235, y: 530, size: 11 });
      secondPage.drawText(document.getElementById("isfc").value, { x: 235, y: 510, size: 11 });

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "TA_DA_filled.pdf";
      link.click();
    }
  </script>
</body>
</html>
